$id: https://raw.githubusercontent.com/thanakijwanavit/villaMasterSchema/master/coupon/coupon.yaml
$schema: https://json-schema.org/draft/2020-12/schema
definitions:
  Condition:
    title: Condition
    type: object
    conditionType:
      type: string
      description: type of the condition
    attribute:
      type:
        - string
        - "null"
      description: attribute to apply operator. if operator not applied then null.
      enum:
        - "base_row_total" # total amount 
        - "qty" # total quantity
        - null
    operator:
      type:
        - string
        - "null"
      enum: ["==", "!=", "<", ">", "<=", ">=", "{}", "!{}", "is one of", "is not one of", null] #==: is, {}:contains, is one of/is not one of is not used by Villa now
    value:
      type:
        - boolean
        - number
        - string
    is_value_processed:
      type: 
        - boolean
        - "null"
      description: not sure what this means in magento. only see null and false.
    aggregator:
      type: string
      enum:
        - all
        - any
    conditions:
      type: array
      items: 
        $ref: '#/definitions/Condition'
    required:
      - conditionType
      - attribute
      - operator
      - value
      - is_value_processed
    
        
  UsedCoupons:
    type: object
    description: coupons that have been used
    properties:
      couponId:
        type: integer
      customerId:
        type: string
      useTime:
        type: integer
    required:
      - couponId
      - customerId
      - userTime
        

type: object
required:
  - couponId
  - couponName
  - active
  - actions
properties:
  couponId:
    type: integer
    description: id of the coupon
  couponName:
    type: string
    description: name of the coupon 
  couponDescription:
    type: string
    description: description of the coupon
  active:
    type: boolean
  couponCodeType:
    type: string
    enum: 
      - fixed
      - auto_generated
      - no_code
  couponCode:
    type: string
    description: coupon code for customers if couponCodeType is fixed.
  usesPerCoupon:
    type: integer
    description: total number of times this coupon can be used (by same and different customers)
  usesPerCustomer:
    type: integer
  startDate:
    type: integer
  endDate:
    type: integer
  conditions:
    $ref: '#/definitions/Condition'
  actions:
    type: object
    description: query language for the actions applied by this coupon
    properties:
      discountType:
        type: 
          - string
          - "null" # null for free shipping
        enum: ["by_fixed", "cart_fixed", "by_percent", "buy_x_get_y_sku", "buy_x_get_y", null]
      discountAmount:
        type: number
      discountQtyStep:
        type: integer
        description: how many X bought to apply this discount for buy X get Y (Y can be sku or discount amount)
      maxQtyDiscountApplied:
        type: integer
        description: the maximum quantity of the same product that can qualify for the discount in the same purchase
      freeShipping:
        type: boolean
      conditions: # apply the rule only to cart items matching the following conditions (leave blank for all items)
        $ref: '#/definitions/Condition'
    required:
      - discountType
  customers:
    type: array
    description: list of customerIds or customer group Ids who are eligible for this coupon
    items:
      type: integer
  branches:
    type: array
    description: list of branchIds that are eligible for this coupon
    items:
      type: string


  